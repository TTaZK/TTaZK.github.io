
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>Spring整合MyBatis框架 - Blog Of ZK</title>
  <meta name="author" content="Z K">

  
  <meta name="description" content="使用MyBatis，面对的是纯粹的Java对象，类似于Hbernate。但是对于具体的数据库操作，Hibernate会自动生成SQL语句，MyBatis 则要求自己自己编写SQL语句。 &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://ttazk.github.io/blog/2017/03/21/spring_mybatis/">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="Blog Of ZK" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="//libs.baidu.com/jquery/1.9.1/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="/javascripts/libs/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="//fonts.googleapis.com/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href="//fonts.googleapis.com/css?family=PT+Sans:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">

  

</head>

<body   >
  <header role="banner"><hgroup>
  <h1><a href="/">Blog Of ZK</a></h1>
  
    <h2>A Java Coder</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://www.baidu.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="sitesearch" value="ttazk.github.io">
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">Blog</a></li>
  <li><a href="/blog/archives">Archives</a></li>
</ul>

</nav>
  <div id="main">
    <div id="content">
      <div>
<article class="hentry" role="article">
  
  <header>
    
      <h1 class="entry-title">Spring整合MyBatis框架</h1>
    
    
      <p class="meta">
        




<time class='entry-date' datetime='2017-03-21T16:21:24+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2017</span></span> <span class='time'>4:21 pm</span></time>
        
      </p>
    
  </header>


<div class="entry-content"><ul>
<li><p>使用MyBatis，面对的是纯粹的Java对象，类似于Hbernate。但是对于具体的数据库操作，Hibernate会自动生成SQL语句，MyBatis 则要求自己自己编写SQL语句。</p></li>
<li><p>每一个MyBatis应用都是以一个SQLSessionFactory对象的实例为核心MyBatis可以拥有多个SQL映射文件，并通过一个配置文件对这些SQL映射文件进行装配，同时在该文件中定义一些控制属性信息。
如下：</p></li>
</ul>


<!--more-->


<p><strong>myBatisConfig.xml</strong></br></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>&lt;?xml version="1.0" encoding="UTF-8" ?&gt;
</span><span class='line'>&lt;!DOCTYPE configuration PUBLIC "-//mybatis.org//DTD Config 3.0//EN"
</span><span class='line'>"http://mybatis.org/dtd/mybatis-3-config.dtd"&gt;
</span><span class='line'>&lt;configuration&gt;
</span><span class='line'>     &lt;!--提供框架运行的属性信息  --&gt;
</span><span class='line'>    &lt;settings&gt;
</span><span class='line'>        &lt;setting name="lazyLoadingEnabled" value="false"/&gt;
</span><span class='line'>    &lt;/settings&gt;
</span><span class='line'>
</span><span class='line'>    &lt;!--指定类的别名,可以在映射文件中使用类的别名  --&gt;
</span><span class='line'>    &lt;typeAliases&gt;
</span><span class='line'>        &lt;typeAlias alias="Information" type="spring_mybatis.Information"/&gt;
</span><span class='line'>    &lt;/typeAliases&gt;
</span><span class='line'>
</span><span class='line'>    &lt;!--指定映射文件  --&gt;
</span><span class='line'>    &lt;mappers&gt;
</span><span class='line'>        &lt;mapper resource="spring_mybatis/InformationMapper.xml"/&gt;
</span><span class='line'>    &lt;/mappers&gt;
</span><span class='line'>&lt;/configuration&gt;</span></code></pre></td></tr></table></div></figure>


<ul>
<li>其中<mappers>属性指定了映射文件的位置。映射文件的配置如下：</br>
<strong>InformationMapper.xml</strong></li>
</ul>


<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>&lt;?xml version="1.0" encoding="UTF-8" ?&gt; 
</span><span class='line'>&lt;!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd"&gt;
</span><span class='line'>&lt;!--命名空间要与调用接口的名称相同  --&gt;
</span><span class='line'>&lt;mapper namespace="spring_mybatis.InformationDAO"&gt;
</span><span class='line'>&lt;!--下面定义映射语句项，映射语句中的id要与映射接口方法的名称相同  --&gt;
</span><span class='line'>&lt;select id="getInformation" resultType="Information" parameterType="String"&gt;
</span><span class='line'>    select * from information where name=#{name}
</span><span class='line'>    &lt;!-- #{name}为对应接口方法的入参 --&gt;
</span><span class='line'>&lt;/select&gt;
</span><span class='line'>
</span><span class='line'>&lt;insert id="addInformation" parameterType="Information"&gt;
</span><span class='line'>    insert into information values(#{name},#{sex},#{address},#{phone})
</span><span class='line'>    &lt;!--#{name},#{sex},#{address},#{phone}对应接口方法参数Information的属性  --&gt;
</span><span class='line'>&lt;/insert&gt;
</span><span class='line'>
</span><span class='line'>&lt;update id="updateInformation" parameterType="Information"&gt;
</span><span class='line'>    update information set
</span><span class='line'>    name=#{name},sex=#{sex},address=#{address}，phone=#{phone}
</span><span class='line'>    &lt;!--#{name},#{sex},#{address},#{phone}对应接口方法参数Information的属性  --&gt;
</span><span class='line'>&lt;/update&gt;
</span><span class='line'>&lt;/mapper&gt;```
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>- 在映射文件中定义了对实体类Information进行数据操作时所用的SQL语句。
</span><span class='line'>在该文件中定义了 select insert及update映射项语句，映射项语句的id唯一，resultType代表了语句的返回值类型，parameterType代表传入参数的类型，可以是全限定类名，也可以是在MyBatis中指定的类的别名；如果参数为String/基础数据类型，可以直接用int,String指定。映射项通过#{xxx}绑定传入参数对象的属性。
</span><span class='line'>
</span><span class='line'>- MyBatis提供了一种可以将SQL映射文件中的映射项，通过名称匹配接口进行调用：定义一个映射接口，接口的全限定名称与映射文件中的命名空间相同，接口方法名称与映射项的id相同。调用接口的方法即可以访问对应的映射项。
</span><span class='line'>如：&lt;/br&gt;
</span><span class='line'>**InformationDAO接口**&lt;/br&gt;</span></code></pre></td></tr></table></div></figure>


<p>package spring_mybatis;
//定义映射接口
//接口的名称与映射命名空间相同
//方法名称与映射项的id相同
//可以通过接口名称及方法名称调用映射文件的映射项
public interface InformationDAO {
    public Information getInformation(String name );
    public void addInformation(Information information);
    public void updateInformation(Information information);</p>

<p>}</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>###定义好了接口，如何使用其中的方法呢？
</span><span class='line'>两种方式：&lt;/br&gt;
</span><span class='line'>**1：通过SqlSessionTemplate获取接口的实例。** 
</span><span class='line'>
</span><span class='line'>DAO类，用于调用映射项，进行数据操作：
</span></code></pre></td></tr></table></div></figure>


<p>package spring_mybatis;
import org.mybatis.spring.SqlSessionTemplate;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;</p>

<p>@Repository(&ldquo;DAO&rdquo;)
public class DAO {
    @Autowired//注入SqlSessionTemplate
    SqlSessionTemplate sessionTemplate;</p>

<pre><code>public SqlSessionTemplate getSessionTemplate() {
    return sessionTemplate;
}

public void setSessionTemplate(SqlSessionTemplate sessionTemplate) {
    this.sessionTemplate = sessionTemplate;
}

public Information getInformation_1(String name ){
    //调用sessionTemplate.getMapper方法返回接口实例，从而可以执行映射项
    InformationDAO informationDAO=sessionTemplate.getMapper(InformationDAO.class);
    return informationDAO.getInformation(name);
}

public void addInformation_1(Information information){
    //调用sessionTemplate.getMapper方法返回接口实例，从而可以执行映射项
    InformationDAO informationDAO=sessionTemplate.getMapper(InformationDAO.class);
    informationDAO.addInformation(information);
}

public void updateInformation(Information information){
    //调用sessionTemplate.getMapper方法返回接口实例，从而可以执行映射项
    InformationDAO informationDAO=sessionTemplate.getMapper(InformationDAO.class);
    informationDAO.updateInformation(information);
}
</code></pre>

<p>}</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>
</span><span class='line'>- **2：使用类型转换器MapperScannerConfigurer，可以将映射接口直接转换成对应的Bean，**&lt;/br&gt;
</span><span class='line'>PS：使用这种方法时，便不需要使用sqlSessionTemplate进行操作。</span></code></pre></td></tr></table></div></figure>


<p>&lt; !&ndash;配置转换器，将映射接口转换成实例，从而进行数据库访问  &ndash;>
<bean class="org.spring.mapper.MapperScannerConfigure"
p:sqlSessionFactory-ref="sqlSessionFactory"
p:basePackage="spring_mybatis"/></p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>然后可以直接在类中注入对应的接口对象，并调用方法使用映射文件中的映射项。
</span><span class='line'>如：&lt;/br&gt;**DAO_1类**
</span></code></pre></td></tr></table></div></figure>


<pre><code>package spring_mybatis;
import org.springframework.beans.factory.annotation.Autowired;
import org.springframework.stereotype.Repository;

@Repository("dao_1")
public class DAO_1 {
    @Autowired
    InformationDAO informationDAO;

    public void getInformation(String name ){
        informationDAO.getInformation(name);
    }
    public void addInformation(Information information){
        informationDAO.addInformation(information);

    }
    public void updateInformation(Information information){
        informationDAO.updateInformation(information);
    }
}
</code></pre>

<p>```</p>

<ul>
<li><p>以上是使用MyBatis访问数据库操作的配置，现在将Spring与MyBatis进行整合。
整合过程在Spring的配置文件中完成。
如下：</br>
<strong>Spring-MyBatis.xml</strong></p>

<p>  &lt; context:component-scan base-package=&ldquo;spring_mybatis&rdquo;/>
  <!--引用属性文件  -->
  <bean class="org.springframework.beans.factory.config.PropertyPlaceholderConfigurer"
  p:location="classpath:jdbc.properties"
  p:fileEncoding="utf-8"/>
  <!--配置数据源,DBCP数据源  -->
  <bean id="datasource_1" class="org.apache.commons.dbcp.BasicDataSource" destroy-method="close"
  p:driverClassName="${driverClassName}"
  p:url="${url}"
  p:username="${username}"
  p:password="${password}"/>
  <!--配置数据源，Spring自身提供  -->
  <bean id="datasource_2" class="org.springframework.jdbc.datasource.DriverManagerDataSource"
  p:driverClassName="com.mysql.jdbc.Driver"
  p:url="jdbc:mysql://localhost:3306/my_student?useSSL=false"
  p:username="root"
  p:password="000000"/></p>

<p>  <!--声明sqlsessionfactory  -->
  <bean id="sqlSessionFactory" class="org.mybatis.spring.SqlSessionFactoryBean">
  <property name="dataSource" ref="datasource_2"></property>
  <property name="configLocation" value="myBatisConfig.xml"></property>
  </bean>
  <!--引用mybatis的配置文件  --></p>

<p>   <!--定义SqlSessionTemplate,可以用来直接访问数据库  -->
  <bean id="sqlSessionTemplate" class="org.mybatis.spring.SqlSessionTemplate">
     &lt; constructor-arg ref=&ldquo;sqlSessionFactory&rdquo;/>
  </bean></p>

<p>  <!-- <bean id="DAO" class="spring_mybatis.DAO"
  p:sessionTemplate-ref="sqlSessionTemplate"/>  &ndash;></p>

<p>  <!--配置转换器，将映射接口转换成实例，从而进行数据库访问  -->
  <bean class="org.mybatis.spring.mapper.MapperScannerConfigurer"
  p:sqlSessionFactory-ref="sqlSessionFactory"
  p:basePackage="spring_mybatis"/></p>

<p>  <bean id="information" class="spring_mybatis.Information"
  p:name="zt"
  p:sex="woman"
  p:address="huan"
  p:phone="521155"/></p></li>
</ul>

</div>


  <footer>
    <p class="meta">
      
  

<span class="byline author vcard">Posted by <span class="fn">Z K</span></span>

      




<time class='entry-date' datetime='2017-03-21T16:21:24+08:00'><span class='date'><span class='date-month'>Mar</span> <span class='date-day'>21</span><span class='date-suffix'>st</span>, <span class='date-year'>2017</span></span> <span class='time'>4:21 pm</span></time>
      

<span class="categories">
  
    <a class='category' href='/blog/categories/spring/'>spring</a>
  
</span>


    </p>
    
      <div class="sharing">
  
  
  
</div>

    
    <p class="meta">
      
        <a class="basic-alignment left" href="/blog/2017/03/19/generic/" title="Previous Post: 泛型程序设计">&laquo; 泛型程序设计</a>
      
      
        <a class="basic-alignment right" href="/blog/2017/03/21/bean_config/" title="Next Post: Bean的配置及注入">Bean的配置及注入 &raquo;</a>
      
    </p>
  </footer>
</article>

</div>

<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/blog/2017/03/21/bean_config/">Bean的配置及注入</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/21/spring_mybatis/">Spring整合MyBatis框架</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/19/generic/">泛型程序设计</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/14/transmission/">运输层</a>
      </li>
    
      <li class="post">
        <a href="/blog/2017/03/09/jvm2/">虚拟机类加载机制</a>
      </li>
    
  </ul>
</section>





  
</aside>


    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2017 - Z K -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a></span>
</p>

</footer>
  











</body>
</html>
